import{i as F,r as L,a as N,j as R,k as S,b as f,d as v,e as d,l as D,f as e,u as n,m as g,p as y,E as V,q as T,t as h,s as M,v as j,x as B,y as z,o as Q,F as E,g as A,L as G,h as k}from"./index-0519772c.js";const H={class:"my-5 row justify-content-center"},I={class:"mb-3"},J=e("label",{for:"email",class:"form-label"},"Email",-1),K={class:"mb-3"},O=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),P={class:"mb-3"},W=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),X={key:0,class:"text-danger"},Y={class:"mb-3"},Z=e("label",{for:"address",class:"form-label"},"收件人地址",-1),ee={class:"mb-3"},te=e("label",{for:"message",class:"form-label"},"留言",-1),se={class:"text-end"},ae=["disabled"],le={__name:"CreateList",props:["cart","phone"],setup(C){const m=C,p=F("axios"),_="vue-winter",u="https://vue3-course-api.hexschool.io/v2",t=L({}),i=N(""),b=o=>{if(o&&o.trim()){const a=/^(09)[0-9]{8}$/;return t.tel=o,a.test(o)?!0:"需要正確的電話號碼"}return!1},x=R(m,"phone"),{errorMessage:c,value:l}=S(x,b),s=()=>{if(t.tel===void 0||t.tel==="")return;const o={user:t,message:i.value};p.post(`${u}/api/${_}/order`,{data:o}).then(()=>{t.email="",t.name="",t.tel="",t.address="",i.value="",alert("訂單建立成功")}).catch(a=>{alert(a)})};return(o,a)=>(f(),v("div",H,[d(n(z),{ref:"form",class:"col-md-6",onSubmit:s},{default:D(({errors:$})=>{var q,w,U;return[e("div",I,[J,d(n(g),{id:"email",name:"email",type:"email",class:y(["form-control",{"is-invalid":$.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:t.email,"onUpdate:modelValue":a[0]||(a[0]=r=>t.email=r)},null,8,["class","modelValue"]),d(n(V),{name:"email",class:"invalid-feedback"})]),e("div",K,[O,d(n(g),{id:"name",name:"姓名",type:"text",class:y(["form-control",{"is-invalid":$.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:t.name,"onUpdate:modelValue":a[1]||(a[1]=r=>t.name=r)},null,8,["class","modelValue"]),d(n(V),{name:"姓名",class:"invalid-feedback"})]),e("div",P,[W,d(n(g),{id:"tel",name:"電話",type:"tel",class:y(["form-control",{"is-invalid":$.電話}]),placeholder:"請輸入電話",rules:"required",modelValue:n(l),"onUpdate:modelValue":a[2]||(a[2]=r=>T(l)?l.value=r:null)},null,8,["class","modelValue"]),b?M("",!0):(f(),v("span",X,h(n(c)),1)),d(n(V),{name:"電話",class:"invalid-feedback"})]),e("div",Y,[Z,d(n(g),{id:"address",name:"地址",type:"text",class:y(["form-control",{"is-invalid":$.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:t.address,"onUpdate:modelValue":a[3]||(a[3]=r=>t.address=r)},null,8,["class","modelValue"]),d(n(V),{name:"地址",class:"invalid-feedback"})]),e("div",ee,[te,j(e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":a[4]||(a[4]=r=>i.value=r)},null,512),[[B,i.value]])]),e("div",se,[e("button",{type:"submit",class:"btn btn-danger",disabled:((U=(w=(q=m.cart)==null?void 0:q.carts)==null?void 0:w.carts)==null?void 0:U.length)===0}," 送出訂單 ",8,ae)])]}),_:1},512)]))}},oe=e("p",{class:"text-center"},"這邊是購物車與建立訂單頁面",-1),ne={class:"text-end"},de={class:"table align-middle"},ie=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價")])],-1),ce=["onClick"],re=e("i",{class:"fas fa-spinner fa-pulse"},null,-1),ue=e("div",{class:"text-success"},"已套用優惠券",-1),me={class:"input-group input-group-sm"},pe={class:"input-group mb-3"},_e=["onUpdate:modelValue","onChange"],he={class:"input-group-text",id:"basic-addon2"},fe={class:"text-end"},ve=e("small",{class:"text-success"},"折扣價：",-1),be=e("td",{colspan:"3",class:"text-end"},"總計",-1),xe={class:"text-end"},$e=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),ge={class:"text-end text-success"},Ve={__name:"CartView",setup(C){const m=F("axios"),p="vue-winter",_="https://vue3-course-api.hexschool.io/v2",u=L({carts:[]}),t=N(!1),i=()=>{t.value=!0,m.get(`${_}/api/${p}/cart`).then(c=>{u.carts=c.data.data,t.value=!1})},b=(c,l,s)=>{const o={product_id:l,qty:s};t.value=!0,m.put(`${_}/api/${p}/cart/${c}`,{data:o}).then(()=>{t.value=!1,i(),alert("已修改購物車商品數量")}).catch(a=>{alert(a),t.value=!1})},x=(c="")=>{t.value=!0,c===""?m.delete(`${_}/api/${p}/carts`).then(()=>{t.value=!1,i(),alert("已刪除全部購物車")}).catch(l=>{t.value=!1,alert(l)}):m.delete(`${_}/api/${p}/cart/${c}`).then(()=>{i(),t.value=!1,alert("已刪除所選購物車")}).catch(l=>{t.value=!1,alert(l)})};return Q(()=>{i()}),(c,l)=>(f(),v(E,null,[d(n(G),{active:t.value,"onUpdate:active":l[0]||(l[0]=s=>t.value=s)},null,8,["active"]),oe,e("div",ne,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:l[1]||(l[1]=s=>x())}," 清空購物車 ")]),e("table",de,[ie,e("tbody",null,[u.carts?(f(!0),v(E,{key:0},A(u.carts.carts,s=>(f(),v("tr",{key:s.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:o=>x(s.id)},[re,k(" x ")],8,ce)]),e("td",null,[k(h(s.product.title)+" ",1),ue]),e("td",null,[e("div",me,[e("div",pe,[j(e("input",{min:"1",type:"number",class:"form-control","onUpdate:modelValue":o=>s.qty=o,onChange:o=>b(s.id,s.product_id,s.qty),ref_for:!0,ref:"productQty"},null,40,_e),[[B,s.qty]]),e("span",he,h(s.product.unit),1)])])]),e("td",fe,[ve,k(" "+h(s.product.price),1)])]))),128)):M("",!0)]),e("tfoot",null,[e("tr",null,[be,e("td",xe,h(u.carts.total),1)]),e("tr",null,[$e,e("td",ge,h(u.carts.final_total),1)])])]),d(le,{cart:u},null,8,["cart"])],64))}};export{Ve as default};
