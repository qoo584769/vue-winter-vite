import{i as L,r as N,a as M,l as R,m as S,b as x,d as $,e as d,p as z,u as n,q as D,f as e,s as y,v as V,E as C,x as T,t as b,y as j,z as B,A as G,o as A,F,h as I,L as Q,j as k}from"./index-a839f59c.js";const H={class:"my-5 row justify-content-center"},J={class:"mb-3"},K=e("label",{for:"email",class:"form-label"},"Email",-1),O={class:"mb-3"},P=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),W={class:"mb-3"},X=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),Y={key:0,class:"text-danger mt-2 d-block fs-6"},Z={class:"mb-3"},ee=e("label",{for:"address",class:"form-label"},"收件人地址",-1),te={class:"mb-3"},se=e("label",{for:"message",class:"form-label"},"留言",-1),ae={class:"text-end"},le=["disabled"],oe={__name:"CreateList",props:["cart","phone"],emits:["emitGetCart"],setup(q,{emit:_}){const m=q,f=L("axios"),u="vue-winter",a="https://vue3-course-api.hexschool.io/v2",s=N({}),h=M(""),v=i=>{if(i&&i.trim()){const o=/^(09)[0-9]{8}$/;return s.tel=i,o.test(i)?!0:"需要正確的電話號碼"}return typeof parseInt(i)=="number"?i:""},r=R(m,"phone"),{errorMessage:l,value:t}=S(r,v),p=async()=>{if(v(s.tel)!=="需要正確的電話號碼"){const i={user:s,message:h.value};await f.post(`${a}/api/${u}/order`,{data:i}).then(()=>{s.email="",s.name="",s.tel="",s.address="",h.value="",alert("訂單建立成功")}).catch(o=>{alert(o)}),_("emitGetCart")}};return(i,o)=>(x(),$("div",H,[d(n(D),{ref:"form",class:"col-md-6",onSubmit:p},{default:z(({errors:g})=>{var w,U,E;return[e("div",J,[K,d(n(y),{id:"email",name:"email",type:"email",class:V(["form-control",{"is-invalid":g.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:s.email,"onUpdate:modelValue":o[0]||(o[0]=c=>s.email=c)},null,8,["class","modelValue"]),d(n(C),{name:"email",class:"invalid-feedback"})]),e("div",O,[P,d(n(y),{id:"name",name:"姓名",type:"text",class:V(["form-control",{"is-invalid":g.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:s.name,"onUpdate:modelValue":o[1]||(o[1]=c=>s.name=c)},null,8,["class","modelValue"]),d(n(C),{name:"姓名",class:"invalid-feedback"})]),e("div",W,[X,d(n(y),{id:"tel",name:"電話",type:"tel",class:V(["form-control",{"is-invalid":g.電話}]),placeholder:"請輸入電話",rules:"required",modelValue:n(t),"onUpdate:modelValue":o[2]||(o[2]=c=>T(t)?t.value=c:null)},null,8,["class","modelValue"]),v?(x(),$("span",Y,b(n(l)),1)):j("",!0),d(n(C),{name:"電話",class:"invalid-feedback"})]),e("div",Z,[ee,d(n(y),{id:"address",name:"地址",type:"text",class:V(["form-control",{"is-invalid":g.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:s.address,"onUpdate:modelValue":o[3]||(o[3]=c=>s.address=c)},null,8,["class","modelValue"]),d(n(C),{name:"地址",class:"invalid-feedback"})]),e("div",te,[se,B(e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":o[4]||(o[4]=c=>h.value=c)},null,512),[[G,h.value]])]),e("div",ae,[e("button",{type:"submit",class:"btn btn-danger",disabled:((E=(U=(w=m.cart)==null?void 0:w.carts)==null?void 0:U.carts)==null?void 0:E.length)===0}," 送出訂單 ",8,le)])]}),_:1},512)]))}},ne=e("p",{class:"text-center"},"這邊是購物車與建立訂單頁面",-1),ie={class:"text-end"},de={class:"table align-middle"},re=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價")])],-1),ce=["onClick"],ue=e("i",{class:"fas fa-spinner fa-pulse"},null,-1),me=e("div",{class:"text-success"},"已套用優惠券",-1),pe={class:"input-group input-group-sm"},_e={class:"input-group mb-3"},fe=["onUpdate:modelValue","onChange"],he={class:"input-group-text",id:"basic-addon2"},ve={class:"text-end"},be=e("small",{class:"text-success"},"折扣價：",-1),xe=e("td",{colspan:"3",class:"text-end"},"總計",-1),$e={class:"text-end"},ge=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),ye={class:"text-end text-success"},Ce={__name:"CartView",setup(q){const _=L("axios"),m="vue-winter",f="https://vue3-course-api.hexschool.io/v2",u=N({carts:[]}),a=M(!1),s=()=>{a.value=!0,_.get(`${f}/api/${m}/cart`).then(r=>{u.carts=r.data.data,a.value=!1})},h=(r,l,t)=>{const p={product_id:l,qty:t};a.value=!0,_.put(`${f}/api/${m}/cart/${r}`,{data:p}).then(()=>{a.value=!1,s(),alert("已修改購物車商品數量")}).catch(i=>{alert(i),a.value=!1})},v=(r="")=>{a.value=!0,r===""?_.delete(`${f}/api/${m}/carts`).then(()=>{a.value=!1,s(),alert("已刪除全部購物車")}).catch(l=>{a.value=!1,alert(l)}):_.delete(`${f}/api/${m}/cart/${r}`).then(()=>{s(),a.value=!1,alert("已刪除所選購物車")}).catch(l=>{a.value=!1,alert(l)})};return A(()=>{s()}),(r,l)=>(x(),$(F,null,[d(n(Q),{active:a.value,"onUpdate:active":l[0]||(l[0]=t=>a.value=t)},null,8,["active"]),ne,e("div",ie,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:l[1]||(l[1]=t=>v())}," 清空購物車 ")]),e("table",de,[re,e("tbody",null,[u.carts?(x(!0),$(F,{key:0},I(u.carts.carts,t=>(x(),$("tr",{key:t.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:p=>v(t.id)},[ue,k(" x ")],8,ce)]),e("td",null,[k(b(t.product.title)+" ",1),me]),e("td",null,[e("div",pe,[e("div",_e,[B(e("input",{min:"1",type:"number",class:"form-control","onUpdate:modelValue":p=>t.qty=p,onChange:p=>h(t.id,t.product_id,t.qty),ref_for:!0,ref:"productQty"},null,40,fe),[[G,t.qty]]),e("span",he,b(t.product.unit),1)])])]),e("td",ve,[be,k(" "+b(t.product.price),1)])]))),128)):j("",!0)]),e("tfoot",null,[e("tr",null,[xe,e("td",$e,b(u.carts.total),1)]),e("tr",null,[ge,e("td",ye,b(u.carts.final_total),1)])])]),d(oe,{cart:u,onEmitGetCart:l[2]||(l[2]=t=>s())},null,8,["cart"])],64))}};export{Ce as default};
